<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../juicy-html/juicy-html.html">
<link rel="import" href="../iron-a11y-keys/iron-a11y-keys.html">

<!--
`a11y-media-transcript-cue`
A single cue in a11y-media-transcriptas static text or as an button that controls media

@demo demo/index.html

@microcopy - the mental model for this element
  <a11y-media-transcript-cue 
    active-cues$="[[activeCues]]"                   // An array of the currently active cues
    cue$="[[cue]]"                                  // An array of cue data
    order$="[[cue.order]]"                          // The index of the current cue
    disable-interactive$="[[disableInteractive]]"   // Is cue interactive? 
    controls$="[[mediaId]]"                         // The id of the a11y-media-player element
    hide-timestamps$="[[hideTimestamps]]" >         // Hide cue timestamp?
  </a11y-media-transcript-cue>

  Custom styles:
  --a11y-media-transcript-bg-color: background color of the transcript, default is #ffffff
  --a11y-media-transcript-text-color: color of the transcript text, default is #000000
  
  Custom styles for focused cue:
  --a11y-media-transcript-focused-cue-text: color of the focused cue text, default is --a11y-media-transcript-text-color
  --a11y-media-transcript-focused-cue-bg: background color of the focused cue, default is --a11y-media-transcript-bg-color
  --a11y-media-transcript-focused-cue-weight: font-weight of the focused cue, default is bold
  
  Custom styles for active cue:
  --a11y-media-transcript-active-cue-text: color of the active cue text, default is --a11y-media-transcript-text-color
  --a11y-media-transcript-active-cue-bg: background color of the active cue, default is #ccfffd
  --a11y-media-transcript-active-cue-weight: font-weight of the active cue, default is normal

-->

<dom-module id="a11y-media-transcript-cue">
  <template>
    <style>
      :host {
        display: table-row;
        background-color: var(--a11y-media-transcript-bg-color, #ffffff);
        color: var(--a11y-media-transcript-text-color, #000000);
      }
      :host[hide-timestamps] {
        display: inline;
      }
      :host:not([disable-interactive]):active,
      :host:not([disable-interactive]):focus,
      :host:not([disable-interactive]):hover {
        cursor: pointer;
        font-weight: var(--a11y-media-transcript-focused-cue-weight, bold);
        color: var(--a11y-media-transcript-focused-cue-text, --a11y-media-transcript-text-color);
        background-color: var(--a11y-media-transcript-focused-cue-bg, #ffffff);
      }
      :host[active] {
        font-weight: var(--a11y-media-transcript-active-cue-weight, normal);
        color: var(--a11y-media-transcript-active-cue-text, --a11y-media-transcript-text-color);
        background-color: var(--a11y-media-transcript-active-cue-bg, #ccfffd);
      }
      :host #text {
        display: table-cell;
        line-height: 200%;
      }
      :host[hide-timestamps] #text {
        display: inline;
      }
      :host #time {
        display: table-cell;
        font-size: 80%;
        padding: 0 1em;
        white-space: nowrap;
        font-family: monospace;
      }
      :host[hide-timestamps] #time {
        display: none;
      }
    </style>
    <span id="time"><juicy-html html$="[[cue.start]] - [[cue.end]]"> </juicy-html></span>
    <span id="text"><juicy-html html$="[[cue.text]]"></juicy-html></span>
    <iron-a11y-keys 
      id="a11y" 
      keys="enter" 
      target$="[[__target]]"
      on-keys-pressed="_onClick">
    </iron-a11y-keys>
  </template>

  <script>
    Polymer({

      is: 'a11y-media-transcript-cue',

      listeners: {
        'tap': '_onClick'
      },

      properties: {
        /* 
         * is cue active 
         */
        active: {
          type: Boolean,
          reflectToAttribute: true,
          computed: '_getActiveCue(cue,activeCues)',
          notify: true,
          reflectToAttribute: true
        },
        /* 
         * array of currently active cues 
         */
        activeCues: {
          type: Array,
          value: null,
          notify: true
        },
        /* 
         * disable interactive mode that makes the transcript clickable 
         */
        disableInteractive: {
          type: Boolean,
          value: false,
        },
        /* 
         * array of cue data 
         */
        cue: {
          type: Array,
          value: null
        },
      },
      ready: function(){
        if(!this.disableInteractive) {
          this.__target = this;
          this.setAttribute('aria-role','button');
          this.setAttribute('tabindex','0');
          this.setAttribute('controls',this.mediaId);
        }
      },
      _getActiveCue: function(cue,cues){
        return cues.includes(cue.order.toString());
      },
      _onClick: function(e){
        if(!this.disableInteractive) {
          this.fire('cue-seek',this);
        }
      },
    });
  </script>
</dom-module>
